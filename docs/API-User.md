# User-related 엔드포인트 기능 및 로직 정리

## 1. 엔드포인트 개요
유저 관련 작업을 수행하기 위한 엔드포인트로, 다음과 같은 주요 기능을 제공합니다:

### 1.1 Bank Account 관련 기능
- **계좌 등록/수정**: 유저의 판매 정산 계좌 정보를 등록하거나 수정
- **계좌 조회**: 등록된 판매 정산 계좌 정보 조회
- **계좌 삭제**: 등록된 판매 정산 계좌 정보 삭제

### 1.2 Blocked Profiles 관련 기능
- **프로필 차단**: 특정 프로필을 차단
- **프로필 차단 해제**: 차단된 프로필 해제
- **차단된 프로필 목록 조회**: 차단된 프로필의 목록 조회

### 1.3 Follow 관련 기능
- **팔로우 등록**: 특정 프로필을 팔로우
- **팔로우 취소**: 팔로우된 프로필을 언팔로우
- **팔로워 조회**: 유저를 팔로우하는 프로필 목록 조회
- **팔로잉 조회**: 유저가 팔로우하는 프로필 목록 조회

### 1.4 Profile 관련 기능
- **프로필 조회**: 유저의 프로필 정보 조회
- **프로필 수정**: 유저의 프로필 정보 수정 (이미지 포함)
- **프로필 이미지 조회**: 특정 프로필의 프로필 이미지 조회

### 1.5 User 관련 기능
- **회원가입**: 새로운 유저 등록
- **로그인**: 이메일과 비밀번호로 로그인 및 JWT 토큰 발급
- **이메일 찾기**: 전화번호를 기반으로 이메일 조회
- **비밀번호 재설정**: 비밀번호 재설정 가능 여부 확인 및 재설정
- **회원 탈퇴**: 유저 계정 삭제

### 1.6 Address 관련 기능
- **주소지 등록**: 유저의 주소 정보 등록
- **주소지 수정**: 기존 주소 정보 수정
- **주소지 삭제**: 특정 주소 정보 삭제
- **주소지 목록 조회**: 유저의 모든 주소 목록 조회
- **단일 주소 조회**: 특정 주소 정보 조회

이 모든 기능은 보안이 적용되어 있으며, 헤더의 JWT 토큰을 기반으로 인증됩니다.

---

## 2. 엔드포인트 상세 설명

### 2.1 Bank Account 관련 엔드포인트

#### 2.1.1 계좌 등록/수정
**엔드포인트:**
```
POST /api/bank-account
```
**필요 권한:** 로그인 유저

**요청 헤더:**
- Authorization: Bearer {JWT 토큰}

**요청 데이터:**
```json
{
  "bankName": "은행명",
  "accountNumber": "계좌번호",
  "accountHolder": "예금주"
}
```

**응답 데이터:**
- 상태 코드 200: "판매 정산 계좌가 성공적으로 등록/수정되었습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 유저가 계좌 정보를 등록하지 않았다면 새로 생성, 기존 계좌가 있다면 업데이트.

---

#### 2.1.2 계좌 조회
**엔드포인트:**
```
GET /api/bank-account
```
**필요 권한:** 로그인 유저

**요청 헤더:**
- Authorization: Bearer {JWT 토큰}

**응답 데이터:**
```json
{
  "bankName": "은행명",
  "accountNumber": "계좌번호",
  "accountHolder": "예금주"
}
```

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 해당 유저의 계좌 정보 반환. 등록된 계좌가 없으면 예외 처리.

---

#### 2.1.3 계좌 삭제
**엔드포인트:**
```
DELETE /api/bank-account
```
**필요 권한:** 로그인 유저

**요청 헤더:**
- Authorization: Bearer {JWT 토큰}

**응답 데이터:**
- 상태 코드 200: "판매 정산 계좌가 성공적으로 삭제되었습니다."
- 상태 코드 400: "삭제할 계좌가 존재하지 않습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 등록된 계좌 정보를 삭제.

---

### 2.2 Blocked Profiles 관련 엔드포인트

#### 2.2.1 프로필 차단
**엔드포인트:**
```
POST /api/profiles/blocked
```
**필요 권한:** 로그인 유저

**요청 데이터:**
```json
{
  "blockedProfileId": 123
}
```

**응답 데이터:**
- 상태 코드 200: "프로필 차단이 완료되었습니다."
- 상태 코드 400: "이미 차단된 프로필입니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 차단할 프로필 ID를 확인 후 차단 리스트에 추가.

---

#### 2.2.2 프로필 차단 해제
**엔드포인트:**
```
DELETE /api/profiles/blocked
```
**필요 권한:** 로그인 유저

**요청 데이터:**
- `blockedProfileId`: 차단 해제할 프로필 ID

**응답 데이터:**
- 상태 코드 200: "프로필 차단이 해제되었습니다."
- 상태 코드 400: "해당 프로필은 차단 목록에 없습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 차단 해제할 프로필이 차단 리스트에 있는지 확인 후 제거.

---

#### 2.2.3 차단된 프로필 목록 조회
**엔드포인트:**
```
GET /api/profiles/blocked
```
**필요 권한:** 로그인 유저

**응답 데이터:**
```json
[
  {
    "profileId": 123,
    "profileName": "프로필 이름",
    "profileImageUrl": "이미지 URL"
  }
]
```

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 차단된 프로필 목록 반환.

---

### 2.3 Follow 관련 엔드포인트

#### 2.3.1 팔로우 등록
**엔드포인트:**
```
POST /api/follows/{profileId}
```
**필요 권한:** 로그인 유저

**요청 데이터:**
- `profileId`: 팔로우할 프로필 ID

**응답 데이터:**
- 상태 코드 200: "팔로우가 성공적으로 추가되었습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 해당 프로필을 팔로우 리스트에 추가.
3. 팔로우 대상 유저에게 알림 전송.

---

#### 2.3.2 팔로우 취소
**엔드포인트:**
```
DELETE /api/follows/{profileId}
```
**필요 권한:** 로그인 유저

**요청 데이터:**
- `profileId`: 팔로우 취소할 프로필 ID

**응답 데이터:**
- 상태 코드 200: "팔로우가 성공적으로 삭제되었습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 해당 프로필을 팔로우 리스트에서 제거.

---

#### 2.3.3 팔로워 조회
**엔드포인트:**
```
GET /api/follows/followers
```
**필요 권한:** 로그인 유저

**응답 데이터:**
```json
{
  "content": [
    {
      "profileId": 123,
      "profileName": "프로필 이름",
      "profileImageUrl": "이미지 URL"
    }
  ],
  "pageable": { ... }
}
```

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 해당 유저를 팔로우하는 프로필 목록 반환.

---

### 2.4 Profile 관련 엔드포인트

#### 2.4.1 프로필 조회
**엔드포인트:**
```
GET /api/profiles
```
**필요 권한:** 로그인 유저

**응답 데이터:**
```json
{
  "profileImage": "이미지 경로",
  "profileName": "프로필 이름",
  "realName": "실명",
  "bio": "소개글",
  "isPublic": true,
  "blockedProfiles": [
    {
      "profileId": 123,
      "profileName": "차단된 프로필 이름",
      "profileImageUrl": "이미지 URL"
    }
  ]
}
```

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 해당 유저의 프로필 정보를 반환.

---

#### 2.4.2 프로필 수정
**엔드포인트:**
```
PUT /api/profiles
```
**필요 권한:** 로그인 유저

**요청 헤더:**
- Authorization: Bearer {JWT 토큰}

**요청 데이터:**
- Content-Type: multipart/form-data
```json
{
  "profileImage": "프로필 이미지 파일 (선택)",
  "dto": {
    "profileName": "프로필 이름",
    "Name": "실명",
    "bio": "소개글",
    "isPublic": true
  }
}
```

**응답 데이터:**
- 상태 코드 200: "프로필이 성공적으로 업데이트되었습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 새로운 이미지가 업로드되었을 경우, 기존 이미지를 삭제 후 새 이미지를 저장.
3. 프로필 이름, 실명, 소개글, 공개 여부를 업데이트.

---

#### 2.4.3 프로필 이미지 조회
**엔드포인트:**
```
GET /api/profiles/{profileId}/image
```
**필요 권한:** 로그인 유저

**요청 데이터:**
- `profileId`: 조회할 프로필의 ID

**응답 데이터:**
- 이미지 바이너리 데이터 (Content-Type: image/png 등)

**기능:**
1. 프로필 ID를 기반으로 해당 프로필의 이미지 파일 경로를 조회.
2. 이미지 파일을 읽어 바이너리 데이터로 반환. 파일이 없을 경우 예외 처리.

---

### 2.5 User 관련 엔드포인트

#### 2.5.1 회원가입
**엔드포인트:**
```
POST /api/users/register
```
**필요 권한:** 없음

**요청 데이터:**
```json
{
  "email": "사용자 이메일",
  "password": "비밀번호",
  "phoneNumber": "전화번호",
  "referralCode": "추천인 코드 (선택)",
  "shoeSize": "신발 사이즈",
  "isOver14": true,
  "termsAgreement": true,
  "privacyAgreement": true,
  "optionalPrivacyAgreement": false,
  "adConsent": false
}
```

**응답 데이터:**
```json
{
  "status": "success",
  "userEmail": "등록된 사용자 이메일"
}
```

**기능:**
1. 이메일 중복 확인.
2. 비밀번호 암호화.
3. 유저 정보 저장 후 기본 프로필 생성.

---

#### 2.5.2 로그인
**엔드포인트:**
```
POST /api/users/login
```
**필요 권한:** 없음

**요청 데이터:**
```json
{
  "email": "사용자 이메일",
  "password": "비밀번호"
}
```

**응답 데이터:**
```json
{
  "token": "JWT 토큰"
}
```

**기능:**
1. 이메일과 비밀번호 확인.
2. JWT 토큰 생성 및 반환.

---

#### 2.5.3 이메일 찾기
**엔드포인트:**
```
POST /api/users/find-email
```
**필요 권한:** 없음

**요청 데이터:**
```json
{
  "phoneNumber": "사용자 전화번호"
}
```

**응답 데이터:**
```json
{
  "email": "찾은 이메일"
}
```

**기능:**
1. 전화번호를 기반으로 등록된 이메일 반환.
2. 등록된 사용자가 없을 경우 예외 처리.

---

#### 2.5.4 비밀번호 재설정

##### 2.5.4.1 사용자 확인
**엔드포인트:**
```
POST /api/users/reset-password
```
**필요 권한:** 없음

**요청 데이터:**
```json
{
  "email": "사용자 이메일",
  "phoneNumber": "전화번호"
}
```

**응답 데이터:**
- 상태 코드 200: "비밀번호 재설정 가능."
- 상태 코드 404: "사용자를 찾을 수 없습니다."

**기능:**
1. 이메일과 전화번호를 기반으로 유저 확인.

##### 2.5.4.2 임시 비밀번호 이메일 전송
**엔드포인트:**
```
POST /api/users/reset-password-sendEmail
```
**필요 권한:** 없음

**요청 데이터:**
```json
{
  "email": "사용자 이메일",
  "phoneNumber": "전화번호"
}
```

**응답 데이터:**
- 상태 코드 200: "임시 비밀번호가 이메일로 전송되었습니다."

**기능:**
1. 임시 비밀번호 생성.
2. 이메일 전송 후 비밀번호 갱신.

---

#### 2.5.5 회원 탈퇴
**엔드포인트:**
```
DELETE /api/users/delete-account
```
**필요 권한:** 로그인 유저

**요청 헤더:**
- Authorization: Bearer {JWT 토큰}

**응답 데이터:**
- 상태 코드 200: "회원 탈퇴가 완료되었습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 유저 관련 정보 삭제.

---

### 2.6 Address 관련 엔드포인트

#### 2.6.1 주소지 등록
**엔드포인트:**
```
POST /api/addresses
```
**필요 권한:** 로그인 유저

**요청 데이터:**
```json
{
  "recipientName": "수령인 이름",
  "phoneNumber": "전화번호",
  "zipCode": "우편번호",
  "address": "주소",
  "detailedAddress": "상세 주소",
  "isDefault": true
}
```

**응답 데이터:**
- 상태 코드 200: "주소록 생성이 완료되었습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 기존 기본 주소지 해제 후 새로운 주소 등록.

---

#### 2.6.2 주소지 수정
**엔드포인트:**
```
PUT /api/addresses
```
**필요 권한:** 로그인 유저

**요청 데이터:**
```json
{
  "addressId": 1,
  "recipientName": "수정된 수령인",
  "phoneNumber": "수정된 전화번호",
  "zipCode": "수정된 우편번호",
  "address": "수정된 주소",
  "detailedAddress": "수정된 상세 주소",
  "isDefault": false
}
```

**응답 데이터:**
- 상태 코드 200: "주소록 수정이 완료되었습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 기존 주소 정보를 업데이트.

---

#### 2.6.3 주소지 삭제
**엔드포인트:**
```
DELETE /api/addresses/{addressId}
```
**필요 권한:** 로그인 유저

**요청 데이터:**
- `addressId`: 삭제할 주소 ID

**응답 데이터:**
- 상태 코드 200: "주소록 삭제가 완료되었습니다."

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 해당 주소 삭제.

---

#### 2.6.4 주소지 목록 조회
**엔드포인트:**
```
GET /api/addresses
```
**필요 권한:** 로그인 유저

**응답 데이터:**
```json
{
  "addresses": [
    {
      "id": 1,
      "recipientName": "수령인",
      "phoneNumber": "전화번호",
      "zipCode": "우편번호",
      "address": "주소",
      "detailedAddress": "상세 주소",
      "isDefault": true
    }
  ]
}
```

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 모든 주소 정보를 반환.

---

#### 2.6.5 단일 주소 조회
**엔드포인트:**
```
GET /api/addresses/{addressId}
```
**필요 권한:** 로그인 유저

**요청 데이터:**
- `addressId`: 조회할 주소 ID

**응답 데이터:**
```json
{
  "id": 1,
  "recipientName": "수령인",
  "phoneNumber": "전화번호",
  "zipCode": "우편번호",
  "address": "주소",
  "detailedAddress": "상세 주소",
  "isDefault": true
}
```

**기능:**
1. 유저 인증 정보에서 이메일 추출.
2. 해당 주소 정보를 반환.


## 3. User Enum Definitions

### 3.1 ShoeSize Enum

```java
package Fream_back.improve_Fream_Back.user.entity;

public enum ShoeSize {
    SIZE_220(220),
    SIZE_225(225),
    SIZE_230(230),
    SIZE_235(235),
    SIZE_240(240),
    SIZE_245(245),
    SIZE_250(250),
    SIZE_255(255),
    SIZE_260(260),
    SIZE_265(265),
    SIZE_270(270),
    SIZE_275(275),
    SIZE_280(280),
    SIZE_285(285),
    SIZE_290(290),
    SIZE_295(295),
    SIZE_300(300);

    private final int value;

    ShoeSize(int value) {
        this.value = value;
    }

    public int getValue() {
        return value;
    }
}
```

### 3.2 Role Enum

```java
package Fream_back.improve_Fream_Back.user.entity;

/**
 * Role
 *
 * 사용자 역할을 정의하는 Enum 클래스입니다.
 * USER와 ADMIN 역할을 구분합니다.
 */
public enum Role {
    USER, // 일반 사용자
    ADMIN // 관리자
}
```

## 4. 보안 및 인증

### 4.1 JWT 기반 인증

1. **JWT 토큰 생성 및 검증**
    - 로그인 시 사용자 이메일과 비밀번호를 확인하여 JWT 토큰을 발급합니다.
    - 각 요청의 `Authorization` 헤더에서 토큰을 추출하여 유효성을 검증합니다.

2. **Redis 화이트리스트**
    - 로그인 성공 시 JWT 토큰은 Redis에 저장되며, 유효한 토큰인지 확인하는 데 사용됩니다.
    - 로그아웃 시 해당 토큰이 Redis에서 제거됩니다.

3. **관리자 권한 확인**
    - JWT 토큰에서 추출한 이메일을 기반으로 사용자의 역할(Role)을 확인합니다.
    - ADMIN 권한이 없는 사용자의 경우 관리자 전용 엔드포인트에 접근할 수 없습니다.

### 4.2 데이터 보호

1. **비밀번호 암호화**
    - 사용자 비밀번호는 Bcrypt 알고리즘을 사용하여 암호화된 상태로 저장됩니다.

2. **개인 정보 보호**
    - 사용자의 민감한 데이터(전화번호, 이메일 등)는 응답 데이터에 포함되지 않으며, 필요 시 최소한의 정보만 반환됩니다.

3. **파일 저장 경로**
    - 사용자 업로드 파일은 `System.getProperty("user.dir") + "/NoticeFiles/"` 경로에 안전하게 저장 및 관리됩니다.

### 4.3 오류 처리

1. **유효하지 않은 토큰**
    - 만료되었거나 잘못된 토큰에 대해 401 Unauthorized 응답을 반환합니다.

2. **권한 부족**
    - ADMIN 권한이 필요한 요청에 대해 권한이 없는 경우 403 Forbidden 응답을 반환합니다.

3. **데이터 접근 오류**
    - 사용자가 자신의 데이터 외의 다른 사용자의 데이터를 요청할 경우 403 Forbidden 응답을 반환합니다.

---


